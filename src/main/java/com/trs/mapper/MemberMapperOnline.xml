<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.trs.mapper.MemberMapperOnline" >
    <resultMap id="BaseResultMap" type="com.trs.model.Member" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" property="id" />
        <result column="username" property="username"  />
        <result column="pwd" property="pwd"  />
        <result column="realname" property="realname"  />
        <result column="gender" property="gender"  />
        <result column="email" property="email" />
        <result column="telephone" property="telephone"  />
        <result column="address" property="address"  />
        <result column="education" property="education"  />
        <result column="major" property="major"  />
        <result column="postcode" property="postcode" />
        <result column="organization" property="organization"  />
        <result column="role_id" property="roleId"  />
        <result column="gmt_create" property="gmtCreate"  />
        <result column="gmt_modified" property="gmtModified" />
        <result column="status" property="status"  />
        <result column="organiza_id" property="organizaId" />
        <result column="uucode" property="uuCode" />
    </resultMap>
    <sql id="Base_Column_List" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, username, pwd, realname, gender, email, telephone, address, education, major,
        postcode, organization, role_id, gmt_create, gmt_modified, status, organiza_id, uucode
    </sql>

    <sql id="sql_where">
        <if test="search != null and search != ''">
            and username LIKE '%${search}%'
        </if>
        <if test="state != null and state != ''">
            AND status = #{state}
        </if>
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List" />
        from member_online
        where id = #{id,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from member_online
        where id = #{id}
    </delete>
    <insert id="insert" parameterType="com.trs.model.Member" >
        insert into member_online (id, username, pwd,
        realname, gender, email,
        telephone, address, education,
        major, postcode, organization,
        role_id, gmt_create, gmt_modified,
        status, organiza_id,uucode)
        values (#{id}, #{username}, #{pwd},
        #{realname}, #{gender}, #{email},
        #{telephone}, #{address}, #{education},
        #{major}, #{postcode}, #{organization},
        #{roleId}, #{gmtCreate}, #{gmtModified},
        #{status}, #{organizaId},#{uuCode})
    </insert>
    <insert id="insertSelective" parameterType="com.trs.model.Member" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into member_online
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="id != null" >
                id,
            </if>
            <if test="username != null" >
                username,
            </if>
            <if test="pwd != null" >
                pwd,
            </if>
            <if test="realname != null" >
                realname,
            </if>
            <if test="gender != null" >
                gender,
            </if>
            <if test="email != null" >
                email,
            </if>
            <if test="telephone != null" >
                telephone,
            </if>
            <if test="address != null" >
                address,
            </if>
            <if test="education != null" >
                education,
            </if>
            <if test="major != null" >
                major,
            </if>
            <if test="postcode != null" >
                postcode,
            </if>
            <if test="organization != null" >
                organization,
            </if>
            <if test="roleId != null" >
                role_id,
            </if>
            <if test="gmtCreate != null" >
                gmt_create,
            </if>
            <if test="gmtModified != null" >
                gmt_modified,
            </if>
            <if test="status != null" >
                status,
            </if>
            <if test="organizaId != null" >
                organiza_id,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="id != null" >
                #{id},
            </if>
            <if test="username != null" >
                #{username},
            </if>
            <if test="pwd != null" >
                #{pwd},
            </if>
            <if test="realname != null" >
                #{realname},
            </if>
            <if test="gender != null" >
                #{gender},
            </if>
            <if test="email != null" >
                #{email},
            </if>
            <if test="telephone != null" >
                #{telephone},
            </if>
            <if test="address != null" >
                #{address},
            </if>
            <if test="education != null" >
                #{education},
            </if>
            <if test="major != null" >
                #{major},
            </if>
            <if test="postcode != null" >
                #{postcode},
            </if>
            <if test="organization != null" >
                #{organization},
            </if>
            <if test="roleId != null" >
                #{roleId},
            </if>
            <if test="gmtCreate != null" >
                #{gmtCreate},
            </if>
            <if test="gmtModified != null" >
                #{gmtModified},
            </if>
            <if test="status != null" >
                #{status,
            </if>
            <if test="organizaId != null" >
                #{organizaId},
            </if>
        </trim>
    </insert>
    <!--更新会员用户信息-->
    <update id="updateByPrimaryKeySelective" parameterType="com.trs.model.Member" >
        update member_online
        <set >
            <if test="username != null" >
                username = #{username},
            </if>
            <if test="pwd != null" >
                pwd = #{pwd},
            </if>
            <if test="realname != null" >
                realname = #{realname},
            </if>
            <if test="gender != null" >
                gender = #{gender},
            </if>
            <if test="email != null" >
                email = #{email},
            </if>
            <if test="telephone != null" >
                telephone = #{telephone},
            </if>
            <if test="address != null" >
                address = #{address},
            </if>
            <if test="education != null" >
                education = #{education},
            </if>
            <if test="major != null" >
                major = #{major},
            </if>
            <if test="postcode != null" >
                postcode = #{postcode},
            </if>
            <if test="organization != null" >
                organization = #{organization},
            </if>
            <if test="roleId != null" >
                role_id = #{roleId},
            </if>
            <if test="gmtCreate != null" >
                gmt_create = #{gmtCreate},
            </if>
            <if test="gmtModified != null" >
                gmt_modified = #{gmtModified},
            </if>
            <if test="status != null" >
                status = #{status},
            </if>
            <if test="organizaId != null" >
                organiza_id = #{organizaId},
            </if>
            <if test="uuCode != null and uuCode != ''">
                uucode = #{uuCode}
            </if>
        </set>
        where id = #{id}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.trs.model.Member" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update member_online
        set username = #{username},
        pwd = #{pwd},
        realname = #{realname},
        gender = #{gender},
        email = #{email},
        telephone = #{telephone},
        address = #{address},
        education = #{education},
        major = #{major},
        postcode = #{postcode},
        organization = #{organization},
        role_id = #{roleId},
        gmt_create = #{gmtCreate},
        gmt_modified = #{gmtModified},
        status = #{status},
        organiza_id = #{organizaId},
        uucode = #{uuCode}
        where id = #{id}
    </update>

    <!--查询所有会员-->
    <select id="listAllMember" parameterType="map" resultMap="BaseResultMap">
        SELECT
        *
        from member_online
        <where>
            <include refid="sql_where"/>
        </where>
--         WHERE
--         organiza_id IS NULL

        <if test="sort == null or sort == ''">
            ORDER BY gmt_create DESC
        </if>
        <if test="sort == 'gmtCreate'">
            ORDER BY gmt_create ${order}
        </if>
        <if test="sort == 'gmtModified'">
            ORDER BY gmt_modified ${order}
        </if>
        limit #{currPage},#{pageSize}
    </select>


    <!--只查询机构的会员-->
    <select id="listAllOrganizeMember" parameterType="map" resultMap="BaseResultMap">
        SELECT
        *
        from member_online



        WHERE

        organiza_id = #{organiza_id}

        <if test="search != null and search != ''">
            and username LIKE '%${search}%'
        </if>

        <if test="state != null and state != ''">
            AND status = #{state}
        </if>


        --         WHERE
        --         organiza_id IS NULL

        <if test="sort == null or sort == ''">
            ORDER BY gmt_create DESC
        </if>
        <if test="sort == 'gmtCreate'">
            ORDER BY gmt_create ${order}
        </if>
        <if test="sort == 'gmtModified'">
            ORDER BY gmt_modified ${order}
        </if>
        limit #{currPage},#{pageSize}
    </select>

    <!--获取user的记录数-->
    <select id="total" parameterType="map" resultType="int">
        SELECT COUNT(*) FROM member_online
        <where>
            <include refid="sql_where"/>
        </where>
    </select>

    <!--获取OrgainizeUser的记录数-->
    <select id="OrganizeTotal" parameterType="map" resultType="int">
        SELECT COUNT(*) FROM member_online
        WHERE

        organiza_id = #{organiza_id}

        <if test="search != null and search != ''">
            and username LIKE '%${search}%'
        </if>

        <if test="state != null and state != ''">
            AND status = #{state}
        </if>
    </select>


    <!--修改账户状态-->
    <update id="changeStatus" parameterType="map">
        UPDATE member_online SET status=#{status}, gmt_modified=#{gmtModified} where id =#{id}
    </update>

    <!-- 修改用户权限 -->
    <update id="changRoleId" parameterType="map">
        UPDATE member_online set role_id = #{roleId} where id = #{id}
    </update>

    <!-- 查找角色是否被占用 -->
    <select id="findMemberByRoleId" parameterType="Member" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/> from member_online where role_id = #{roleId} and id != #{id};
    </select>

    <!-- 查询会员 -->
    <select id="findMemberByUserName" parameterType="string" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/> from member_online where username = #{userName}
    </select>
    <select id="findMemberByEmail" parameterType="string" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/> from member_online where email = #{email}
    </select>

    <!-- 修改用户权限 -->
    <update id="updataOrganize" parameterType="map">
        UPDATE member_online set organization = #{organization},organiza_id=#{organizaId} where id = #{id}
    </update>


    <!-- 修改机构在线 -->
    <update id="updataOrganizeByUserName" parameterType="map">
        UPDATE member_online set organization = #{orgName},organiza_id=#{orgId} where username = #{username}
    </update>


    <!--查询会员根据机构ID-->
    <select id="findMemberByOrgId" parameterType="map" resultMap="BaseResultMap">
        SELECT
        *
        from member_online
        WHERE
        <if test="search != null and search != ''">
            username LIKE '%${search}%' AND
        </if>
        <if test="state != null and state != ''">
            status = #{state} AND
        </if>
        organiza_id=#{orgId}

        <if test="sort == null or sort == ''">
            ORDER BY gmt_create DESC
        </if>
        <if test="sort == 'gmtCreate'">
            ORDER BY gmt_create ${order}
        </if>
        <if test="sort == 'gmtModified'">
            ORDER BY gmt_modified ${order}
        </if>
        limit #{currPage},#{pageSize}
    </select>

</mapper>